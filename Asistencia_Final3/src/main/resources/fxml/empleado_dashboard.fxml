<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.*?>

<BorderPane xmlns="http://javafx.com/javafx/17"
            xmlns:fx="http://javafx.com/fxml/1"
            fx:controller="pe.edu.upeu.asistencia.controller.EmpleadoDashboardController"
            prefWidth="950" prefHeight="650" style="-fx-background-color: #f7fafc;">

    <!-- Header -->
    <top>
        <VBox>
            <HBox alignment="CENTER_LEFT" spacing="20.0" style="-fx-background-color: #667eea; -fx-padding: 15;">
                <Label text="Mi Panel">
                    <font>
                        <Font name="System Bold" size="20.0"/>
                    </font>
                    <style>-fx-text-fill: white;</style>
                </Label>

                <Region HBox.hgrow="ALWAYS"/>

                <Label fx:id="lblUsuario" text="Empleado: " style="-fx-text-fill: white;"/>
                <Label fx:id="lblMensajesNoLeidos" text="" style="-fx-text-fill: #fbbf24; -fx-font-weight: bold;"/>
                <Button text="Cerrar Sesion" onAction="#handleCerrarSesion"
                        style="-fx-background-color: white; -fx-text-fill: #667eea; -fx-font-weight: bold; -fx-background-radius: 5;"/>
            </HBox>

            <!-- Información del Horario -->
            <VBox style="-fx-background-color: #e0e7ff; -fx-padding: 10;">
                <Label fx:id="lblHorarioInfo" text="Tu horario: Cargando..."
                       style="-fx-font-size: 13px; -fx-font-weight: bold;"/>
            </VBox>
        </VBox>
    </top>

    <!-- Content con TabPane -->
    <center>
        <TabPane tabClosingPolicy="UNAVAILABLE" style="-fx-background-color: white;">

            <!-- Tab Mi Perfil -->
            <Tab text="Mi Perfil">
                <ScrollPane fitToWidth="true" fitToHeight="true">
                    <VBox spacing="20.0" alignment="TOP_CENTER" style="-fx-padding: 30 40;">

                        <!-- Información Personal -->
                        <VBox spacing="15" alignment="CENTER" style="-fx-background-color: white; -fx-padding: 20; -fx-background-radius: 10; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 0);">
                            <Label text="Información Personal">
                                <font>
                                    <Font name="System Bold" size="18.0"/>
                                </font>
                            </Label>

                            <GridPane hgap="15" vgap="12" maxWidth="500">
                                <Label text="Nombre:" GridPane.columnIndex="0" GridPane.rowIndex="0" style="-fx-font-weight: bold;"/>
                                <Label fx:id="lblNombre" text="-" GridPane.columnIndex="1" GridPane.rowIndex="0"/>

                                <Label text="Usuario:" GridPane.columnIndex="0" GridPane.rowIndex="1" style="-fx-font-weight: bold;"/>
                                <Label fx:id="lblUsername" text="-" GridPane.columnIndex="1" GridPane.rowIndex="1"/>

                                <Label text="Rol:" GridPane.columnIndex="0" GridPane.rowIndex="2" style="-fx-font-weight: bold;"/>
                                <Label fx:id="lblRol" text="-" GridPane.columnIndex="1" GridPane.rowIndex="2"/>
                            </GridPane>
                        </VBox>

                        <Separator maxWidth="500"/>

                        <!-- Registrar Asistencia -->
                        <VBox spacing="15" alignment="CENTER" style="-fx-background-color: white; -fx-padding: 20; -fx-background-radius: 10; -fx-effect: dropshadow(three-pass-box, rgba(0,0,0,0.1), 10, 0, 0, 0);">
                            <Label text="Registrar Asistencia de Hoy">
                                <font>
                                    <Font name="System Bold" size="16.0"/>
                                </font>
                            </Label>

                            <HBox spacing="20" alignment="CENTER">
                                <Label fx:id="lblFechaHoy" text="Fecha: ">
                                    <font>
                                        <Font size="14.0"/>
                                    </font>
                                </Label>
                                <Label fx:id="lblHoraActual" text="Hora: ">
                                    <font>
                                        <Font size="14.0"/>
                                    </font>
                                </Label>
                            </HBox>

                            <!-- Estado de asistencia de hoy -->
                            <Label fx:id="lblEstadoAsistenciaHoy" text="Estado Hoy: Sin registrar"
                                   style="-fx-font-size: 14px; -fx-font-weight: bold;"/>

                            <!-- BOTONES DE ENTRADA Y SALIDA -->
                            <HBox spacing="15" alignment="CENTER">
                                <Button fx:id="btnMarcarAsistencia" text="Marcar Entrada"
                                        onAction="#handleMarcarAsistencia"
                                        style="-fx-background-color: #48bb78; -fx-text-fill: white; -fx-font-weight: bold; -fx-background-radius: 5; -fx-padding: 10 20;"
                                        prefWidth="180" prefHeight="40">
                                    <font>
                                        <Font name="System Bold" size="14.0"/>
                                    </font>
                                </Button>

                                <Button fx:id="btnRegistrarSalida" text="Registrar Salida"
                                        onAction="#handleRegistrarSalida"
                                        style="-fx-background-color: #f59e0b; -fx-text-fill: white; -fx-font-weight: bold; -fx-background-radius: 5; -fx-padding: 10 20;"
                                        prefWidth="180" prefHeight="40">
                                    <font>
                                        <Font name="System Bold" size="14.0"/>
                                    </font>
                                </Button>
                            </HBox>


                        </VBox>
                    </VBox>
                </ScrollPane>
            </Tab>

            <!-- Tab Mis Asistencias -->
            <Tab text="Mis Asistencias">
                <VBox spacing="15.0" style="-fx-padding: 20;">

                    <HBox spacing="10.0" alignment="CENTER_LEFT">
                        <Label text="Ver asistencias de:">
                            <font>
                                <Font name="System Bold" size="13.0"/>
                            </font>
                        </Label>
                        <ComboBox fx:id="cboPeriodo" promptText="Seleccione período" prefWidth="150"/>
                        <Button text="Buscar" onAction="#handleBuscarMisAsistencias"
                                style="-fx-background-color: #667eea; -fx-text-fill: white; -fx-padding: 5 15; -fx-background-radius: 5;"/>
                    </HBox>

                    <TableView fx:id="tableMisAsistencias" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="colMiAsistFecha" text="Fecha" prefWidth="120"/>
                            <TableColumn fx:id="colMiAsistEntrada" text="Hora Entrada" prefWidth="120"/>
                            <TableColumn fx:id="colMiAsistSalida" text="Hora Salida" prefWidth="120"/>
                            <TableColumn fx:id="colMiAsistEstado" text="Estado" prefWidth="120"/>
                            <TableColumn fx:id="colMiAsistObs" text="Observaciones" prefWidth="300"/>
                        </columns>
                    </TableView>

                    <!-- Resumen Estadístico -->
                    <Separator/>
                    <Label text="Resumen de Asistencias:">
                        <font>
                            <Font name="System Bold" size="14.0"/>
                        </font>
                    </Label>
                    <HBox spacing="20.0" alignment="CENTER">
                        <Label fx:id="lblTotalPresente" text="✓ Presente: 0"
                               style="-fx-background-color: #d4edda; -fx-text-fill: #155724; -fx-padding: 10; -fx-background-radius: 5;"/>
                        <Label fx:id="lblTotalTarde" text="⚠ Tarde: 0"
                               style="-fx-background-color: #fff3cd; -fx-text-fill: #856404; -fx-padding: 10; -fx-background-radius: 5;"/>
                        <Label fx:id="lblTotalAusente" text="✗ Ausente: 0"
                               style="-fx-background-color: #f8d7da; -fx-text-fill: #721c24; -fx-padding: 10; -fx-background-radius: 5;"/>
                        <Label fx:id="lblTotalJustificado" text="ℹ Justificado: 0"
                               style="-fx-background-color: #d1ecf1; -fx-text-fill: #0c5460; -fx-padding: 10; -fx-background-radius: 5;"/>
                    </HBox>
                </VBox>
            </Tab>

            <!-- Tab Mis Vacaciones -->
            <Tab text="Mis Vacaciones">
                <VBox spacing="15.0" style="-fx-padding: 20;">

                    <HBox spacing="10.0" alignment="CENTER_LEFT">
                        <Button text="Solicitar Vacaciones" onAction="#handleSolicitarVacaciones"
                                style="-fx-background-color: #48bb78; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 8 15; -fx-background-radius: 5;"/>
                        <Region HBox.hgrow="ALWAYS"/>
                        <Button text="Actualizar" onAction="#handleActualizarVacaciones"
                                style="-fx-background-color: #667eea; -fx-text-fill: white; -fx-padding: 8 15; -fx-background-radius: 5;"/>
                    </HBox>

                    <TableView fx:id="tableMisVacaciones" VBox.vgrow="ALWAYS">
                        <columns>
                            <TableColumn fx:id="colVacFechaInicio" text="Fecha Inicio" prefWidth="120"/>
                            <TableColumn fx:id="colVacFechaFin" text="Fecha Fin" prefWidth="120"/>
                            <TableColumn fx:id="colVacDias" text="Días" prefWidth="60"/>
                            <TableColumn fx:id="colVacEstado" text="Estado" prefWidth="120"/>
                            <TableColumn fx:id="colVacFechaSolicitud" text="Fecha Solicitud" prefWidth="180"/>
                        </columns>
                    </TableView>


                </VBox>
            </Tab>

           <!-- Tab Mis Mensajes -->
           <Tab text="Mis Mensajes">
               <VBox spacing="15.0" style="-fx-padding: 20;">

                   <HBox spacing="10.0">
                       <Button text="Nuevo Mensaje" onAction="#handleNuevoMensaje"
                               style="-fx-background-color: #48bb78; -fx-text-fill: white; -fx-font-weight: bold; -fx-padding: 8 15; -fx-background-radius: 5;"/>
                       <Button text="Actualizar" onAction="#handleActualizarMensajes"
                               style="-fx-background-color: #667eea; -fx-text-fill: white; -fx-padding: 8 15; -fx-background-radius: 5;"/>
                       <Button text="Marcar todos como leidos" onAction="#handleMarcarTodosLeidos"
                               style="-fx-padding: 8 15;"/>
                   </HBox>

                   <TableView fx:id="tableMisMensajes" VBox.vgrow="ALWAYS" prefHeight="300">
                       <columns>
                           <TableColumn fx:id="colMiMsjEmisor" text="De" prefWidth="180"/>
                           <TableColumn fx:id="colMiMsjAsunto" text="Asunto" prefWidth="300"/>
                           <TableColumn fx:id="colMiMsjFecha" text="Fecha" prefWidth="150"/>
                           <TableColumn fx:id="colMiMsjLeido" text="Leido" prefWidth="60"/>
                       </columns>
                   </TableView>

                   <VBox spacing="10.0" style="-fx-background-color: #f8f9fa; -fx-padding: 15; -fx-background-radius: 5;">
                       <Label text="Contenido del mensaje:" style="-fx-font-weight: bold;"/>
                       <TextArea fx:id="txtMensajeContenido" wrapText="true" editable="false"
                                 prefHeight="150" promptText="Seleccione un mensaje para ver su contenido"
                                 style="-fx-border-color: #dee2e6; -fx-background-radius: 5;"/>
                   </VBox>
               </VBox>
           </Tab>
        </TabPane>
    </center>

    <!-- Footer -->
    <bottom>
        <HBox alignment="CENTER" style="-fx-background-color: #edf2f7; -fx-padding: 10;">
            <Label text="Sistema de Asistencia v1.0" style="-fx-text-fill: #718096; -fx-font-size: 11px;"/>
        </HBox>
    </bottom>
</BorderPane>